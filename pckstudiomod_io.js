!function(t){var e={};function o(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(i,r,function(e){return t[e]}.bind(null,r));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";o.r(e);class i{constructor(t,e){this.key=t.toUpperCase(),this.value=e}toString(){return`${this.key}\t${this.value}`}}const r=["HEAD","BODY","ARM0","ARM1","LEG0","LEG1"];class n{constructor(){this.t="",this.x=0,this.y=0,this.z=0,this.xs=0,this.ys=0,this.zs=0,this.u=0,this.v=0,this.f=0,this.m=0,this.s=0}static fromStr(t){let e=new n,o=t.split(" "),i=o.shift();return o=o.map(t=>Number.parseFloat(t)),e.t=i,e.x=o[0],e.y=o[1],e.z=o[2],e.xs=o[3],e.ys=o[4],e.zs=o[5],e.u=o[6],e.v=o[7],e.f=o[8],e.m=o[9],e.s=o[10],e}set position(t){this.x=t[0],this.y=t[1],this.z=t[2]}set size(t){this.xs=t[0],this.ys=t[1],this.zs=t[2]}set uv(t){this.u=t[0],this.v=t[1]}get from(){return[-this.x-this.xs,-this.y-this.ys,this.z]}get to(){return[-this.x,-this.y,this.z+this.zs]}get uv(){return[this.u,this.v]}get array(){return[this.t,this.x,this.y,this.z,this.xs,this.ys,this.zs,this.u,this.v,this.f,this.m,this.s]}addPos(t){this.x+=t[0],this.y+=t[1],this.z+=t[2]}subPos(t){this.x-=t[0],this.y-=t[1],this.z-=t[2]}toString(){return"BOX\t"+this.array.join(" ")}}function s(t){let e=new n;switch(t){case"HEAD":e.position=[-4,-8,-4],e.size=[8,8,8],e.uv=[0,0];break;case"BODY":e.position=[-4,0,-2],e.size=[8,12,4],e.uv=[16,16];break;case"LEG0":e.position=[-2,0,-2],e.size=[4,12,4],e.uv=[0,16];break;case"LEG1":e.position=[-2,0,-2],e.size=[4,12,4],e.uv=[0,16],e.m=1;break;case"ARM0":e.position=[-3,-2,-2],e.size=[4,12,4],e.uv=[40,16];break;case"ARM1":e.position=[-1,-2,-2],e.size=[4,12,4],e.uv=[40,16],e.m=1}let o=new Cube({name:"_"+t});return o.extend({from:e.from,to:e.to,autouv:1}).init(),o.setUVMode(!0),o.extend({uv_offset:e.uv,mirror_uv:1===e.m}),null!=Project.selected_texture&&o.applyTexture(Project.selected_texture),o}function u(t,e){t.forEachChild(t=>{t.moveVector(e,null,!0),t.transferOrigin(e,!0)},Cube),t.transferOrigin(e,!0)}function a(t){return Project.groups.find(e=>e.name==t)}!function(){let t,e,o,c;BBPlugin.register("pckstudiomod_io",{title:"pckstudio-mod propdump IO",icon:"icon.png",author:"coyote",description:"Handles import and export for pckstudio-mod propdumps (.tsv).",tags:["Minecraft: Legacy Console Edition","Importer","Exporter"],version:"0.0.0",min_version:"4.9.0",variant:"both",onload(){o=new Codec("pckstudiomod_io",{name:"pckstudio-mod Propdump (.tsv)",extension:"tsv",export_options:{displayname:{label:"Display name",type:"text",value:"Exported Model"},themename:{label:"Theme name",type:"text",value:"Blockbench"},game_flags:{label:"Game flags",type:"text",value:"0x16"},anim:{label:"Anim",type:"text",value:"0x00000000"}},compile(){let t=this.getExportOptions(),e=[new i("FREE","1"),new i("DISPLAYNAME",t.displayname),new i("THEMENAME",t.themename),new i("GAME_FLAGS",t.game_flags),new i("ANIM",t.anim)];return Project.groups.forEach(t=>{if(function(t,e){for(let o of e)if(t===o)return!0;return!1}(t.name,r))for(let o of function t(e,o=[]){for(let i of e.children)i instanceof Group?t(i,o):i instanceof Cube&&o.push(i);return o}(t))if(o.name!="_"+t.name){let i=new n;i.t=t.name,i.size=o.getSize(),i.position=o.to,i.subPos(t.origin),i.z-=i.zs,i.x-=i.xs,i.y=-i.y,i.uv=o.uv_offset,i.m=o.mirror_uv?1:0,e.push(i)}}),e.map(t=>t.toString()).join("\n")},parse(t){let e=t.split(/(?:\r\n|\n)+/);!function(){for(let t of r){let e=a(t);if(null==e){let e=new Group({name:t}).init().addTo();s(t).addTo(e)}else{let t=e.origin;t[0]=-t[0],t[1]=-t[1],t[2]=-t[2],u(e,t)}}}();for(let t of e){let e=t.indexOf("\t"),o=t.substring(0,e),i=t.substring(e+1,t.length);if("BOX"==o){let t=n.fromStr(i),e=a(t.t);null==e&&(e=new Group({name:t.t}).init().addTo());let o=new Cube({from:t.from,to:t.to,autouv:1}).init();o.setUVMode(!0),o.extend({uv_offset:t.uv}),null!=Project.selected_texture&&o.applyTexture(Project.selected_texture),o.addTo(e)}}u(a("HEAD"),[0,24,0]),u(a("BODY"),[0,24,0]),u(a("LEG0"),[1.9,12,0]),u(a("LEG1"),[-1.9,12,0]),u(a("ARM0"),[5,22,0]),u(a("ARM1"),[-5,22,0]),Canvas.updateAll()}}),c=new ModelFormat({id:"pckstudiomod_io",name:"pckstudio-mod BOX model",category:"minecraft",target:["pckstudio-mod","Minecraft: Legacy Console Edition"],description:"Custom player model for pckstudio-mod.",icon:"icon-player",meshes:!1,rotate_cubes:!1,bone_rig:!1,box_uv:!0,uv_rotation:!1,animation_mode:!1,animated_textures:!1,centered_grid:!0,edit_mode:!0,single_texture:!0,codec:o,format_page:{content:[{type:"h3",text:tl("mode.start.format.informations")},{text:"* In Minecraft: Legacy Console Edition, the bottom face of every cube is flipped vertically: what would be the bottom of the texture in Blockbench is actually on top in game. You can check if your texture is correct by exporting your model, importing it into pckstudio-mod and using the skin preview feature.\n* You can export the model as a propdump using the `File > Export` action or with the `Save Model` action.\n* You can then import the resulting TSV into pckstudio-mod by right-clicking an existing skin and selecting `Import > Import property dump`.\n* Raw property import/export in TSV is a feature only available in [my fork of PCK Studio](https://github.com/wily-coyote/PCK-Studio), which is what this format is built around."},{type:"h3",text:tl("mode.start.format.resources")},{text:"* [The fork of PCK Studio this model format works with](https://github.com/wily-coyote/PCK-Studio)"}]},new(){newProject(this),Project.texture_width=64,Project.texture_height=32,o.parse(""),new Promise((t,e)=>{SharedActions.runSpecific("select_all","outliner"),TextureGenerator.addBitmap({resolution:[64,32]},o=>TextureGenerator.generateTemplate({box_uv:!0,resolution:16,rearrange_uv:!1},o).then(e=>{SharedActions.runSpecific("unselect_all","outliner"),t(e)}).catch(t=>{e(t)}))})}}),t=new Action("pckstudiomod_io_importer",{name:"Import pckstudio-mod Propdump",category:"file",description:"Import a .tsv file exported from pckstudio-mod.",icon:"fa-file-import",click(){Blockbench.import({extensions:["tsv"],type:"pckstudio-mod Propdump",readtype:"text"},t=>{console.log("This is Chinese Slavery"),o.parse(t[0].content)})}}),e=new Action("pckstudiomod_io_export",{name:"Export pckstudio-mod Propdump",category:"file",description:"Exports a .tsv file for importing in pckstudio-mod.",icon:"fa-file-export",click(){o.export()}}),MenuBar.menus.file.addAction(t,"import"),MenuBar.menus.file.addAction(e,"export")},onunload(){MenuBar.menus.file.removeAction(t),MenuBar.menus.file.removeAction(e),t.delete(),e.delete(),o.delete(),c.delete()}})}()}]);